<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CapRadio Signal Status</title>

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #f9fafb;
        color: #111827;
        margin: 0;
        padding: 2rem;
      }

      h1 {
        margin: 0 0 0.75rem 0;
        font-size: 1.6rem;
        font-weight: 600;
      }

      .top-bar {
        max-width: 900px;
        margin: 0 auto 1.5rem auto;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      button {
        padding: 0.45rem 1rem;
        border-radius: 999px;
        border: 1px solid #d1d5db;
        background: #f3f4f6;
        color: #111827;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.15s, border-color 0.15s;
      }

      button:hover {
        background: #e5e7eb;
        border-color: #cbd5e1;
      }

      .stack {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
      }

      .card {
        background: #ffffff;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e5e7eb;
      }

      .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.35rem;
      }

      .card-meta {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 0.75rem;
      }

      pre {
        margin: 0;
        background: #f3f4f6;
        border-radius: 0.5rem;
        padding: 1rem;
        overflow: auto;
        font-size: 0.9rem;
        line-height: 1.35;
        border: 1px solid #e5e7eb;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

  .status-green {
        background: #d1fae5 !important; /* green-100 */
        border-color: #10b981 !important; /* green-500 */
        color: #064e3b !important; /* green-900 */
}

  .status-red {
  background: #fee2e2 !important; /* red-100 */
  border-color: #ef4444 !important; /* red-500 */
  color: #7f1d1d !important; /* red-900 */
}

    </style>
  </head>

  <body>
    <div class="top-bar">
      <div>
        <h1>CapRadio News</h1>
        <button id="refresh">Refresh now</button>
      </div>
    </div>

    <div class="stack">
      <!-- 13 vertical cards -->
      <!-- You can rename card titles anytime -->
      <!-- Slot 1 -->
      <div class="card">
        <div class="card-title">90.9 FM Sacramento KXJZ</div>
        <div class="card-meta" id="meta-1">Last Updated: —</div>
        <pre id="output-1">Waiting for data…</pre>
      </div>

      <!-- Slot 2 -->
      <div class="card">
        <div class="card-title">90.5 FM Tahoe/Reno KKTO</div>
        <div class="card-meta" id="meta-2">Last Updated: —</div>
        <pre id="output-2">Waiting for data…</pre>
      </div>

      <!-- Slot 3 -->
      <div class="card">
        <div class="card-title">91.3 FM Stockton/Modesto KUOP</div>
        <div class="card-meta" id="meta-3">Last Updated: —</div>
        <pre id="output-3">Waiting for data…</pre>
      </div>

      <!-- Slot 4 -->
      <div class="card">
        <div class="card-title">88.1 FM Quincy KQNC</div>
        <div class="card-meta" id="meta-4">Last Updated: —</div>
        <pre id="output-4">Waiting for data…</pre>
      </div>

    <div class="top-bar">
      <div>
        <h1 style="margin-top: 1.5rem">CapRadio Music</h1>
        <button id="refresh">Refresh now</button>
      </div>
    </div>
      
      <!-- Slot 5 -->
      <div class="card">
        <div class="card-title">88.9 FM Sacramento KXPR</div>
        <div class="card-meta" id="meta-5">Last Updated: —</div>
        <pre id="output-5">Waiting for data…</pre>
      </div>

      <!-- Slot 6 -->
      <div class="card">
        <div class="card-title">91.7 FM Groveland/Sonora KXSR</div>
        <div class="card-meta" id="meta-6">Last Updated: —</div>
        <pre id="output-6">Waiting for data…</pre>
      </div>

      <!-- Slot 7 -->
      <div class="card">
        <div class="card-title">88.7 FM Sutter/Yuba City KXJS</div>
        <div class="card-meta" id="meta-7">Last Updated: —</div>
        <pre id="output-7">Waiting for data…</pre>
      </div>

      <!-- Slot 8 -->
      <div class="card">
        <div class="card-title">Translator South Lake Tahoe K201AJ</div>
        <div class="card-meta" id="meta-8">Last Updated: —</div>
        <pre id="output-8">Waiting for data…</pre>
      </div>

      <!-- Slot 9 -->
      <div class="card">
        <div class="card-title">Translator South Lake Tahoe K211EF</div>
        <div class="card-meta" id="meta-9">Last Updated: —</div>
        <pre id="output-9">Waiting for data…</pre>
      </div>

    <div class="top-bar">
      <div style="margin-top: 1.5rem">
        <h1>Streaming</h1>
        <button id="refresh">Refresh now</button>
      </div>
    </div>
      
      <!-- Slot 10 -->
      <div class="card">
        <div class="card-title">News Station Stream</div>
        <div class="card-meta" id="meta-10">Last Updated: —</div>
        <pre id="output-10">Waiting for data…</pre>
      </div>
      
      <!-- Slot 11 -->
      <div class="card">
        <div class="card-title">Music Station Stream</div>
        <div class="card-meta" id="meta-11">Last Updated: —</div>
        <pre id="output-11">Waiting for data…</pre>
      </div>
      
      <!-- Slot 12 -->
      <div class="card">
        <div class="card-title">JazzStream</div>
        <div class="card-meta" id="meta-12">Last Updated: —</div>
        <pre id="output-12">Waiting for data…</pre>
      </div>
      
      <!-- Slot 13 -->
      <div class="card">
        <div class="card-title">ClassicalStream</div>
        <div class="card-meta" id="meta-13">Last Updated: —</div>
        <pre id="output-13">Waiting for data…</pre>
      </div>
      
    </div>

    <script>
      const CARD_COUNT = 13;

      async function loadSlot(slot) {
        const output = document.getElementById("output-" + slot);
        const meta = document.getElementById("meta-" + slot);

        try {
          const res = await fetch(
            "/.netlify/functions/pathfinder-hook?slot=" + slot
          );
          const data = await res.json();

          if (data.error) {
            meta.textContent = "Last Updated: —";
            output.textContent = data.error;
            return;
          }

          meta.textContent = data.receivedAt
            ? "Last Updated: " + new Date(data.receivedAt).toLocaleString()
            : "Last Updated: —";

          output.textContent = data.rawBody || "No rawBody found.";
        } catch (err) {
          output.textContent = "Error: " + err;
        }
      }

      function loadAll() {
        for (let slot = 1; slot <= CARD_COUNT; slot++) {
          loadSlot(slot);
        }
      }

      document.getElementById("refresh").addEventListener("click", loadAll);

      // Auto-refresh every 10 seconds
      setInterval(loadAll, 10000);

      // Initial load
      loadAll();
    </script>
  </body>
</html>
