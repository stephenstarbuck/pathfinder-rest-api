<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Pathfinder REST Monitor</title>

    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
        background: #f9fafb;
        color: #111827;
        margin: 0;
        padding: 2rem;
      }

      h1 {
        margin: 0 0 0.75rem 0;
        font-size: 1.6rem;
        font-weight: 600;
      }

      .top-bar {
        max-width: 900px;
        margin: 0 auto 1.5rem auto;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      button {
        padding: 0.45rem 1rem;
        border-radius: 999px;
        border: 1px solid #d1d5db;
        background: #f3f4f6;
        color: #111827;
        cursor: pointer;
        font-size: 0.9rem;
        transition: background 0.15s, border-color 0.15s;
      }

      button:hover {
        background: #e5e7eb;
        border-color: #cbd5e1;
      }

      .stack {
        max-width: 900px;
        margin: 0 auto;
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
      }

      .card {
        background: #ffffff;
        border-radius: 0.75rem;
        padding: 1.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e5e7eb;
      }

      .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 0.35rem;
      }

      .card-meta {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 0.75rem;
      }

      pre {
        margin: 0;
        background: #f3f4f6;
        border-radius: 0.5rem;
        padding: 1rem;
        overflow: auto;
        font-size: 0.9rem;
        line-height: 1.35;
        border: 1px solid #e5e7eb;
        white-space: pre-wrap;
        word-wrap: break-word;
        min-height: 3rem;
      }
    </style>
  </head>

  <body>
    <div class="top-bar">
      <div>
        <h1>Pathfinder REST Monitor</h1>
        <div style="font-size:0.85rem; color:#6b7280;">
          10 channels • Auto-refresh every 10 seconds
        </div>
      </div>
      <button id="refresh">Refresh now</button>
    </div>

    <div class="stack">
      <!-- 10 vertical cards -->
      <!-- You can rename card titles anytime -->
      <!-- Slot 1 -->
      <div class="card">
        <div class="card-title">Slot 1</div>
        <div class="card-meta" id="meta-1">Last Updated: —</div>
        <pre id="output-1">Waiting for data…</pre>
      </div>

      <!-- Slot 2 -->
      <div class="card">
        <div class="card-title">Slot 2</div>
        <div class="card-meta" id="meta-2">Last Updated: —</div>
        <pre id="output-2">Waiting for data…</pre>
      </div>

      <!-- Slot 3 -->
      <div class="card">
        <div class="card-title">Slot 3</div>
        <div class="card-meta" id="meta-3">Last Updated: —</div>
        <pre id="output-3">Waiting for data…</pre>
      </div>

      <!-- Slot 4 -->
      <div class="card">
        <div class="card-title">Slot 4</div>
        <div class="card-meta" id="meta-4">Last Updated: —</div>
        <pre id="output-4">Waiting for data…</pre>
      </div>

      <!-- Slot 5 -->
      <div class="card">
        <div class="card-title">Slot 5</div>
        <div class="card-meta" id="meta-5">Last Updated: —</div>
        <pre id="output-5">Waiting for data…</pre>
      </div>

      <!-- Slot 6 -->
      <div class="card">
        <div class="card-title">Slot 6</div>
        <div class="card-meta" id="meta-6">Last Updated: —</div>
        <pre id="output-6">Waiting for data…</pre>
      </div>

      <!-- Slot 7 -->
      <div class="card">
        <div class="card-title">Slot 7</div>
        <div class="card-meta" id="meta-7">Last Updated: —</div>
        <pre id="output-7">Waiting for data…</pre>
      </div>

      <!-- Slot 8 -->
      <div class="card">
        <div class="card-title">Slot 8</div>
        <div class="card-meta" id="meta-8">Last Updated: —</div>
        <pre id="output-8">Waiting for data…</pre>
      </div>

      <!-- Slot 9 -->
      <div class="card">
        <div class="card-title">Slot 9</div>
        <div class="card-meta" id="meta-9">Last Updated: —</div>
        <pre id="output-9">Waiting for data…</pre>
      </div>

      <!-- Slot 10 -->
      <div class="card">
        <div class="card-title">Slot 10</div>
        <div class="card-meta" id="meta-10">Last Updated: —</div>
        <pre id="output-10">Waiting for data…</pre>
      </div>
    </div>

    <script>
      const CARD_COUNT = 10;

      async function loadSlot(slot) {
        const output = document.getElementById("output-" + slot);
        const meta = document.getElementById("meta-" + slot);

        try {
          const res = await fetch(
            "/.netlify/functions/pathfinder-hook?slot=" + slot
          );
          const data = await res.json();

          if (data.error) {
            meta.textContent = "Last Updated: —";
            output.textContent = data.error;
            return;
          }

          meta.textContent = data.receivedAt
            ? "Last Updated: " + new Date(data.receivedAt).toLocaleString()
            : "Last Updated: —";

          output.textContent = data.rawBody || "No rawBody found.";
        } catch (err) {
          output.textContent = "Error: " + err;
        }
      }

      function loadAll() {
        for (let slot = 1; slot <= CARD_COUNT; slot++) {
          loadSlot(slot);
        }
      }

      document.getElementById("refresh").addEventListener("click", loadAll);

      // Auto-refresh every 10 seconds
      setInterval(loadAll, 10000);

      // Initial load
      loadAll();
    </script>
  </body>
</html>
